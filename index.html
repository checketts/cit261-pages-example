<html>

<head>
    <script src="//cdnjs.cloudflare.com/ajax/libs/dropbox.js/0.10.2/dropbox.min.js">
    </script>

    <script>
        // Browser-side applications do not use the API secret.
        var client = new Dropbox.Client({
            key: "g7dox4251949j1u"
        });
        var person = {};
        
        var updateFromServer = function(){
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "https://api.mongolab.com/api/1/databases/cit231/collections/students/52a6ac46e4b014699831312a?apiKey=o8R4p1ZGRQpCgQX1xe6mV1UeWZch45i4", true);
            xhr.setRequestHeader("Content-Type", "application/json");

            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    console.log(xhr.responseText)
                    person = JSON.parse(xhr.responseText);
                    
                    output.textContent = person.name + " " + person.count;
                }
            }
            xhr.send();
        };

        var startup = function() {
            var output = document.getElementById("output");
            
            
            var clickLink = document.getElementById("clickLink");
            clickLink.addEventListener("click",function(e){
                e.preventDefault();
                console.log("clicked");
                person.count += 1;
                var xhr = new XMLHttpRequest();
                xhr.open("PUT", "https://api.mongolab.com/api/1/databases/cit231/collections/students/52a6ac46e4b014699831312a?apiKey=o8R4p1ZGRQpCgQX1xe6mV1UeWZch45i4", true);
                xhr.setRequestHeader("Content-Type", "application/json");
    
                xhr.onreadystatechange = function() {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        console.log("put completed")
                        updateFromServer();
                    }
                }
                xhr.send(JSON.stringify(person));
            });

            output.textContent = "Bob";
            updateFromServer();
//            
            
            


        }


        document.addEventListener("DOMContentLoaded", startup, false)
    </script>


</head>

<body>
    Hi there, check it out. Fastish.

    <div id="output">out</div>
    
    <a id="clickLink">Click to add to count</a>

</body>

</html>
